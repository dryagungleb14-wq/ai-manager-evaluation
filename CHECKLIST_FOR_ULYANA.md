# Чек-лист "Для Ульяны" - Документация

## Обзор

Добавлен новый чек-лист "Для Ульяны" для оценки звонков по квалификации лидов с системой оценки 0/0.5/1.

## Изменения в коде

### 1. Новые файлы чек-листа

#### `server/data/for-ulyana-checklist.ts`
Серверная версия чек-листа, используемая для анализа.

#### `client/src/data/for-ulyana-checklist.ts`
Клиентская версия чек-листа (дубликат для MVP).

### 2. Изменения в существующих файлах

#### `server/index.ts`
- Добавлен импорт `forUlyanaChecklist`
- Чек-лист добавлен в массив для инициализации БД: `seedDefaultAdvancedChecklists([preTrialChecklist, forUlyanaChecklist])`

#### `server/services/advanced-gemini-analyzer.ts`
- Оптимизирован системный промпт для Gemini AI (сокращен на ~40%)
- Улучшена структура запроса для уменьшения времени ответа
- Изменения направлены на предотвращение timeout при анализе

## Структура чек-листа

Чек-лист "Для Ульяны" содержит **7 этапов** с **13 критериями**:

### 1. Установление контакта (1 критерий)
- 1.1 Установление контакта

### 2. Квалификация (1 критерий)
- 2.1 Квалификация

### 3. Выявление потребностей (3 критерия)
- 3.1 Вопросы вторичной квалификации
- 3.2 Вопрос о цели обучения
- 3.3 Резюмирование потребности

### 4. Презентация (4 критерия)
- 4.1 Презентация обучения из потребности клиента
- 4.2 Презентация формата обучения
- 4.3 Презентация стоимости
- 4.4 Озвучивание информации для проведения пробного занятия

### 5. Работа с возражениями (1 критерий)
- 5.1 Работа с возражениями

### 6. Завершение сделки (1 критерий)
- 6.1 Завершение сделки

### 7. Голосовые характеристики (2 критерия)
- 7.1 Оценивается грамотность и формулировки
- 7.2 Инициатива за ведение диалога

## Система оценки

Каждый критерий оценивается по шкале 0/0.5/1:

- **MAX (1 балл)** - критерий выполнен полностью
- **MID (0.5 балла)** - критерий выполнен частично
- **MIN (0 баллов)** - критерий не выполнен или выполнен плохо

**Максимальный балл:** 13 (по 1 баллу за каждый критерий)

## Использование

### В интерфейсе

1. Откройте приложение
2. В выпадающем списке "Чек-лист" выберите "Для Ульяны"
3. Загрузите аудиофайл звонка или вставьте текст диалога
4. Нажмите "Проверить"
5. Система проанализирует звонок по всем 13 критериям
6. Результаты отобразятся с баллами и комментариями по каждому этапу

### API

```javascript
// POST /api/advanced-checklists/analyze
{
  "transcript": "текст диалога...",
  "checklistId": "for-ulyana-checklist",
  "language": "ru",
  "source": "call"
}
```

## Оптимизация промпта Gemini

Внесены следующие улучшения для предотвращения timeout:

1. **Сокращен системный промпт** - убраны избыточные объяснения
2. **Компактный формат** - использование сокращенных ключей (n, t, w, d, s)
3. **Упрощенные инструкции** - минимизирован текст запроса
4. **Структурированный JSON** - четкая схема ответа

### Сравнение размера промпта

- **Было:** ~620 символов в системном промпте
- **Стало:** ~370 символов в системном промпте
- **Сокращение:** ~40%

## Технические детали

### Формат данных

Чек-лист использует тип `AdvancedChecklist` из `shared/schema.ts`:

```typescript
{
  id: string;
  name: string;
  version: string;
  type: "advanced";
  totalScore: number;
  stages: ChecklistStage[];
}
```

### Хранение в БД

Чек-лист автоматически добавляется в базу данных при первом запуске сервера через функцию `seedDefaultAdvancedChecklists()`.

Таблицы:
- `advanced_checklists` - основная информация
- `checklist_stages` - этапы чек-листа
- `checklist_criteria` - критерии оценки

## Проверка установки

После деплоя можно проверить наличие чек-листа:

```bash
# GET /api/advanced-checklists
# Должен вернуть массив с "pre-trial-checklist" и "for-ulyana-checklist"
```

## Критерии приемки

✅ Чек-лист "Для Ульяны" доступен в UI
✅ Структура корректна (7 этапов, 13 критериев, баллы 0/0.5/1)
✅ Промпт оптимизирован (сокращен на 40%)
✅ Билд проходит успешно
✅ TypeScript компилируется без ошибок
⏳ Анализ проходит без timeout (требуется тестирование)
⏳ Результаты корректно отображаются (требуется тестирование)

## Дальнейшие шаги

1. Тестирование на реальных аудиофайлах
2. Проверка времени выполнения анализа
3. Валидация корректности оценки по критериям
4. Сбор обратной связи от пользователей

## Примечания

- Чек-лист специально разработан для оценки звонков по обучению
- Система 0/0.5/1 позволяет более точно оценивать частичное выполнение критериев
- Все критерии имеют одинаковый вес (1 балл), что упрощает интерпретацию результатов
